image: rust

stages:
    - build
    - test

BuildDocs:
    stage: build
    script:
        - cargo doc --no-deps
    artifacts:
        name: "lunesrs" 
        expose_as: "docs"
        when: always
        paths:
            - target/docs/lunesrs/

BuildRelease:
    stage: build
    script:
        - cargo build --release
    artifacts:
        name: "lunesrs" 
        expose_as: "release"
        when: always
        paths:
            - target/release/


BuildPackage:
    before_script:
        - cargo install wasm-pack
    stage: build
    script:
        - wasm-pack build --target nodejs
    artifacts:
        name: "lunesrs" 
        expose_as: "lunesjs"
        when: always
        paths:
            - pkg/

CreateReportTests:
    stage: test
    script:
        - cargo test
    needs:
        - job: "BuildRelease"
    # artifacts:
    #     when: always
    #     reports:
    #         junit: report.xml

TestNodeJsWebAssembly:
    before_script:
        - cargo install wasm-pack
    stage: test
    script:
        - wasm-pack test --node
    needs:
        - job: "BuildPackage"

# DeployPackage:
#     before_script:
#         - cargo install wasm-pack
#     stage: deploy
#     script:
#         - wasm-pack login -u $USR_NPM -p $PWD_NPM
#         - wasm-pack build --target nodejs
#         - wasm-pack publish