image: rust

stages:
    - test
    - build

CreateReportTests:
    stage: test
    script:
        - cargo test
    # artifacts:
    #     when: always
    #     reports:
    #         junit: report.xml

# TestNodeJsWebAssembly:
#     before_script:
#         - cargo install wasm-pack
#     stage: test
#     script:
#         - wasm-pack test --node

BuildPackage:
    before_script:
        - cargo install wasm-pack
    stage: build
    script:
        - wasm-pack build --target nodejs
    artifacts:
        name: "lunescrab wasm" 
        expose_as: "pre-release"
        when: always
        paths:
            - pkg/

# DeployPackage:
#     before_script:
#         - cargo install wasm-pack
#     stage: deploy
#     script:
#         - cargo install wasm-pack
#         - wasm-pack login -u $USR_NPM -p $PWD_NPM
#         - wasm-pack build --target nodejs
#         - wasm-pack publish